<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Movies!</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>

  </head>
  <body>
    Main body section
    <!-- <div id="chart"></div> -->

    <script type="text/javascript">
      let rawData = "";
      let rawTitles = [];
      let titles = [];
      let rawLinks = [];
      let links = [];
      let rawImageUrls = [];
      let imageUrls = [];
      let rawSales = [];
      let sales = [];
      let complete = [];
      let dataCollection  = [];

      $.getJSON('http://www.whateverorigin.org/get?url=' + encodeURIComponent('http://www.imdb.com/chart/boxoffice') + '&callback=?', function(data) {
	      rawData = data.contents.slice(36150, 49173);

        rawTitles = rawData.match(/ >.*?</g);
        titles = rawTitles.map(title => title.slice(2, -1))

        rawLinks = rawData.match(/href="\/title.*?"\n>/g);
        links = rawLinks.map(link => "http://www.imdb.com/" + link.slice(6, -3))

        rawImageUrls = rawData.match(/img src=".*?"/g);
        imageUrls = rawImageUrls.map(img => img.slice(9, -1));

        rawSales = rawData.match(/\$.*</g);
        sales = rawSales.map(sale  => parseFloat(sale.slice(1, -2)));

        complete = [titles, links, imageUrls, sales]

        for (var i = 0; i < 10; i++) {
          dataCollection[i] = {
                    titles: `${titles[i]}`,
                    links: `${links[i]}`,
                    imageUrls: `${imageUrls[i]}`,
                    sales: `${sales[i]}`
                  }
        }

        console.log(dataCollection);

//d3 function
        // (function(dataCollection) {
          var svg = d3.select("body").append("svg")
            .attr("id", "chart")
            .attr("width", 600)
            .attr("height", 400)
            // .append('g')
            // .attr("transform", "translate(0,0)")

          var simulation = d3.forceSimulation()

          // d3.queue()
          //   .defer(d3.csv, "sales.csv")
            // .await(ready)


          // function ready (error, datapoints) {
            // var circles = svg.selectAll(".titles")
            //   .data(datapoints)
            //   .enter().append("rect")
            //   .attr("class", "titles")
            //   .attr("r", 10)
            //   .attr("fill", "lightblue")


            svg.selectAll(".circle")
              .data(dataCollection)
              .enter().append("circle")
              .attr("class", "circle")
              .attr("cx", d => d.sales)
              .attr("cy", d => d.sales)
              .attr("r", d => d.sales / 3)
              .attr("text", d => d.titles);

            // simulation.nodes(datapoints)
            //
            // function ticked() {
            //   circles
            //     .attr("cx"), function(d) {
            //       return d.x
            //     }
            //     .attr("cy"), function(d) {
            //       return d.y
            //     }
            // } // end ticked
          // } // end ready

        // }); // end wrap function





      }); //match to line 27 getJSON

    </script>
    <!-- <script src="bubble.js"></script> -->
  </body>
</html>
